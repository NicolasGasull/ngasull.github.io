<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Articles | Nico&#x27;s Lab</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/67269c7d1e9da300.css" as="style"/><link rel="stylesheet" href="/_next/static/css/67269c7d1e9da300.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-11be7a5831576890.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3b641619ed056464.js" defer=""></script><script src="/_next/static/chunks/814-f83b2571d190bfbd.js" defer=""></script><script src="/_next/static/chunks/pages/fr-84b805e15e422270.js" defer=""></script><script src="/_next/static/XfiD0591POrqhAMreRIZE/_buildManifest.js" defer=""></script><script src="/_next/static/XfiD0591POrqhAMreRIZE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="ng-header"><h1>Le labo de Nico</h1><h3 class="py-2 md:p-0">🔭 🎶 🕺</h3><nav><a href="/fr">Blog</a> / <a href="/fr/about">À propos</a> / <a href="/fr/rss.xml">RSS</a> / <a href="/">🇬🇧</a></nav></header><main aria-label="Content"><h1>Articles</h1><article><h3><a href="/fr/blog/pourquoi-docker">📖 Pourquoi Docker ?</a></h3>Blog » 6 août 2020 » devops</article><article><h3><a href="/fr/blog/gerer-ses-permissions-avec-docker">📖 Gérer ses permissions avec Docker</a></h3>Blog » 1 sept. 2020 » devops</article></main><footer class="mt-8 text-center"><p>Copyright © 2019<!-- -->-2022<!-- --> <a href="/fr/about">Nicolas Gasull</a></p><address class="space-x-5"><a href="https://www.twitter.com/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#twitter"></use></svg></a><a href="https://www.github.com/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#github"></use></svg></a><a href="https://stackoverflow.com/users/2219133/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#stackoverflow"></use></svg></a><a href="https://www.linkedin.com/in/nicolasgasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#linkedin"></use></svg></a><a href="/fr/about"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#at"></use></svg></a><a href="/fr/rss.xml"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#rss"></use></svg></a></address></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"locale":"fr","articles":[{"date":"2020-08-06","slug":"pourquoi-docker","lang":"fr","title":"Pourquoi Docker ?","html":"\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_travailler_ensemble\"\u003ePour travailler ensemble\u003c/h2\u003e\u003cp\u003eTout le monde développe sur différentes machines. Il n’est pas rare que plusieurs collègues aient installé différentes version d’une même library, d’un package manager, du runtime de leur application…​ (cc node/npm 👋)\u003c/p\u003e\n\u003cp\u003eLorsque l’application de développement est dockerisée, tous les devs (et la prod !) sont soumis aux mêmes règles, ce qui évite le syndrôme de \u003cem\u003e\"mais ça marche sur mon PC\"\u003c/em\u003e tout en réduisant la configuration nécessaire à installer l’environnement de dev. Voir juste après !\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_moins_perdre_de_temps_à_configurer\"\u003ePour moins perdre de temps à configurer\u003c/h2\u003e\u003cp\u003eLa configuration, c’est du temps passé à ne pas être productif. Plus il y a d’environnements dans lesquels une application doit tourner, plus il y a de configuration à faire. Docker permet d’abstraire l’environnement dans lequel tourne l’application et donc de ne faire que le minimum nécessaire.\u003c/p\u003e\n\u003cp\u003eUne conséquence notable : pour ajouter un service à la stack, plus forcément besoin d’apprendre en détails une technologie. Il suffit d’ajouter une image existante de celle-ci, et de simplement spécifier les variables d’environnement nécessaires. Par exemple, pour \u003ca href=\"https://hub.docker.com/_/postgres/\"\u003eajouter une database PostgreSQL\u003c/a\u003e, il suffit au minimum de renseigner un root password et de monter un volume pour persister les données.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_séparer_les_problèmes\"\u003ePour séparer les problèmes\u003c/h2\u003e\u003cp\u003eComme chaque service est aussi simple que possible, chacun n’a que très peu de dépendances avec le reste du monde. On voit que, par nature, les conteneurs nous poussent à n’avoir que le minimum vital de dépendances entre services.\u003c/p\u003e\n\u003cp\u003ePar dépendances, je pense en particulier à :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003eSystème, programmes, libraries installées\u003c/li\u003e\u003cli\u003eConfigurations associées à ce setup\u003c/li\u003e\u003cli\u003eVolumes (fichiers)\u003c/li\u003e\u003cli\u003eAccès réseau\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_gérer_et_sécuriser_les_connexions_réseau\"\u003ePour gérer et sécuriser les connexions réseau\u003c/h2\u003e\u003cp\u003eCar oui : c’est vite fait de faire fuiter le port d’une database, et \u003ca href=\"https://www.bleepingcomputer.com/news/security/new-meow-attack-has-deleted-almost-4-000-unsecured-databases/\"\u003equand elle n’est pas sécurisée c’est gênant\u003c/a\u003e 😬\u003c/p\u003e\n\u003cp\u003eL’idée est de penser un service comme une boîte noire qui expose un ou plusieurs ports. Les services communiquent entre eux grâce aux volumes montés en commun ou à travers des ports internes. En effet, les \u003ca href=\"https://docs.docker.com/compose/networking/\"\u003eservices appartenant à un même réseau\u003c/a\u003e peuvent par défaut s’accéder entre eux.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pièges_et_trucs_à_savoir\"\u003ePièges et trucs à savoir\u003c/h2\u003e\u003cp\u003eSous Windows et Mac, les conteneurs tournent sur une VM. Du coup c’est lent, pas natif et les lectures/écritures disque peuvent ralentir l’édition de fichiers. La solution est simple : utilise Linux 😏 (ou un Windows/Mac puissant)\u003c/p\u003e\n\u003cp\u003eLorsqu’un même volume (dossier) est monté en écriture dans deux conteneurs à la fois, on peut se retrouver avec des comportements inattendus : chez moi, l’intégralité du dossier généré par un run de build disparaissait en même temps que le conteneur à la fin du run. Je recommande donc vivement de ne monter en écriture qu’un seul fichier ou dossier à la fois.\u003c/p\u003e\n\u003cp\u003eC’est possible de ne partager en écriture qu’une partie d’une même arborescence commune. Par exemple, si \u003ccode\u003ebackend\u003c/code\u003e et \u003ccode\u003efrontend\u003c/code\u003e partagent \u003ccode\u003ecode\u003c/code\u003e en lecture mais que \u003ccode\u003ebackend\u003c/code\u003e doit écrire dans \u003ccode\u003ecode/target\u003c/code\u003e et \u003ccode\u003efrontend\u003c/code\u003e doit écrire dans \u003ccode\u003ecode/dist\u003c/code\u003e, alors les volumes peuvent être surchargés comme ceci :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yml hljs language-yaml\" data-lang=\"yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebackend:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code:/code:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code/target:/code/target\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code:/code:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code/dist:/code/dist\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLes images Docker peuvent vite prendre de l’espace disque. Mais avec le temps, la communauté opte de plus en plus pour des versions minimalistes de chaque image. Autrefois avec une version \u003cem\u003eslim\u003c/em\u003e de Debian, et aujourd’hui souvent avec une version \u003ca href=\"https://alpinelinux.org/about/\"\u003eAlpine Linux\u003c/a\u003e qui permet aux images de faire moins de 10Mo de base ! Préfère-donc utiliser les tags \u003ccode\u003e-alpine\u003c/code\u003e de chaque image.\u003c/p\u003e\n\u003cp\u003eEnfin, la gestion des permissions est déroutante au début. Docker tourne en root par défaut et a de bonnes raisons de le faire : autant dire que j’apprécie de pouvoir ouvrir les ports 80 ou 443 en dev comme en prod 🙂\u003c/p\u003e\n\u003cp\u003ePour mieux comprendre pourquoi et comment bien gérer ses permissions : \u003ca href=\"/fr/blog/gerer-ses-permissions-avec-docker\"\u003evoir cet article\u003c/a\u003e.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_par_où_commencer\"\u003ePar où commencer?\u003c/h2\u003e\u003cp\u003eEn prenant le temps de lire la doc dans l’ordre, tout ne peut que bien se passer :\u003c/p\u003e\n\u003cdiv class=\"olist arabic\"\u003e\u003col class=\"arabic\"\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/get-started/overview/\"\u003eComprends Docker\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/compose/\"\u003eComprends docker compose\u003c/a\u003e pour simplement faire cohabiter les services entre eux\u003c/li\u003e\u003cli\u003eInstalle \u003ca href=\"https://docs.docker.com/engine/install/\"\u003edocker\u003c/a\u003e et \u003ca href=\"https://docs.docker.com/compose/install/\"\u003eson plugin compose\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user\"\u003eAjoute ton user au groupe \u003ccode\u003edocker\u003c/code\u003e\u003c/a\u003e pour piloter le daemon sans \u003ccode\u003esudo\u003c/code\u003e\u003c/li\u003e\u003cli\u003eC’est parti ! N’oublie pas de garder la configuration la plus simple possible.\u003c/li\u003e\u003c/ol\u003e\u003c/div\u003e\n\u003cdetails\u003e\u003csummary\u003eExemple\u003c/summary\u003e\u003cdiv class=\"content\"\u003e\u003cp\u003eUne stack complète React/Rust/PostgreSQL pourrait être lancée avec la simple config suivante à la racine d’un projet :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yml hljs language-yaml\" data-lang=\"yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epostgres:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePOSTGRES_PASSWORD=yolo\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./db/data:/var/lib/postgresql/data\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebackend:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erust:slim\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGHOST=db\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGDATABASE=monservice\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGUSER=root\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGPASSWORD=yolo\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./backend/:/home/backend\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./webapp/:/home/webapp:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecargo\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erun\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:4000\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enode:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBACKEND_URL=http://backend:4000/\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./webapp/:/home/webapp\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esh\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-c\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"yarn install \u0026amp;\u0026amp; CI=true yarn start\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:8080\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003edocker compose up -d\u003c/code\u003e et c’est parti directement sur \u003ca href=\"http://localhost\"\u003elocalhost\u003c/a\u003e ! 💻\u003c/p\u003e\u003c/div\u003e\u003c/details\u003e\u003c/section\u003e","categories":["devops"]},{"date":"2020-09-01","slug":"gerer-ses-permissions-avec-docker","lang":"fr","title":"Gérer ses permissions avec Docker","html":"\u003csection id=\"preamble\" aria-label=\"Preamble\"\u003e\u003cp\u003eTout d’abord soyons d’accord sur les mots :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003eL'\u003cstrong\u003e\u003cem\u003ehôte\u003c/em\u003e\u003c/strong\u003e est le système d’exploitation de la machine, celui qui fait tourner Docker lui-même\u003c/li\u003e\u003cli\u003eNous utiliserons \u003cstrong\u003e\u003cem\u003econteneur\u003c/em\u003e\u003c/strong\u003e pour se référer à ce qui est exécuté dans l’univers de Docker\u003c/li\u003e\u003cli\u003eLes \u003cstrong\u003e\u003cem\u003euser namespaces\u003c/em\u003e\u003c/strong\u003e, que j’appellerai \u003cstrong\u003e\u003cem\u003esubuids\u003c/em\u003e\u003c/strong\u003e, sont une fonctionnalité native Unix pour faire correspondre les ids d’utilisateurs système vers une page d’utilisateurs donnée.\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eL’article décrit comment utiliser les user namespaces (\u003cem\u003esubuids\u003c/em\u003e) dans un environnement Unix pour réserver une plage d’utilisateurs au daemon Docker. Il est probable que Docker for Mac supporte cette fonctionnalité.\u003c/p\u003e\u003c/section\u003e\u003cnav id=\"toc\" class=\"toc\" role=\"doc-toc\"\u003e\u003ch2 id=\"toc-title\"\u003eTable des matières\u003c/h2\u003e\u003col class=\"toc-list level-1\"\u003e\u003cli\u003e\u003ca href=\"#_motivation\"\u003eMotivation\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_mise_en_place\"\u003eMise en place\u003c/a\u003e\u003col class=\"toc-list level-2\"\u003e\u003cli\u003e\u003ca href=\"#_mappings_de_dev\"\u003eMappings de dev\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_mappings_de_ciproduction\"\u003eMappings de CI/production\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_problèmes_et_trucs_à_savoir\"\u003eProblèmes et trucs à savoir\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_motivation\"\u003eMotivation\u003c/h2\u003e\u003cp\u003eSur l’hôte, sans configuration donnée, les fichiers manipulés par Docker appartiennent au même utilisateur que celui du conteneur. Ce n’est pas rassurant dans le sens où le daemon Docker tourne en \u003ccode\u003eroot\u003c/code\u003e par défaut et que les conteneurs ne sont pas tenus de s’exécuter en tant que l’utilisateur qui leur a été donné en configuration.\u003c/p\u003e\n\u003cfigure class=\"example-block\"\u003e\u003cfigcaption\u003eExemple :\u003c/figcaption\u003e\n\u003cdiv class=\"example\"\u003eLes images \u003ccode\u003epostgres\u003c/code\u003e et \u003ccode\u003emysql\u003c/code\u003e écrivent d’elles-mêmes une partie de leurs fichiers avec les les utilisateurs de PostgreSQL et MySQL.\u003c/div\u003e\u003c/figure\u003e\n\u003cp\u003ePour éviter ce problème, nous allons indiquer au daemon Docker à quels utilisateurs hôte correspondent tous les utilisateurs des conteneurs.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_mise_en_place\"\u003eMise en place\u003c/h2\u003e\u003ch5 id=\"_configuration_hôte_impactée\" class=\"discrete\"\u003eConfiguration hôte impactée :\u003c/h5\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003e/etc/subuid\u003c/code\u003e - configuration des mappings utilisateur hôte ⇐⇒ conteneur\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/etc/subgid\u003c/code\u003e - configuration des mappings groupe hôte ⇐⇒ conteneur\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/etc/docker/daemon.json\u003c/code\u003e - configuration du daemon Docker\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eSelon moi, c’est avantageux de configurer différemment ces mappings sur les machines des développeurs et en CI/production. En effet : autant tirer profit de cette flexibilité pour développer confortablement tout en gardant la production sous contrôle.\u003c/p\u003e\n\u003csection class=\"doc-section level-2\"\u003e\u003ch3 id=\"_mappings_de_dev\"\u003eMappings de dev\u003c/h3\u003e\u003cp\u003eEn mappant le \u003ccode\u003eroot\u003c/code\u003e des conteneurs vers ton utilisateur hôte, tu peux simplement profiter d’une transparence de permissions par défaut. Plus de problèmes avec les volumes générés en \u003ccode\u003eroot\u003c/code\u003e hôte puis crashant l’exécution à cause de la mauvaise permission !\u003c/p\u003e\n\u003cp\u003ePour ma part, je map simplement \u003ccode\u003eroot\u003c/code\u003e vers mon user hôte puis tous les autres uids 1+ vers 100001+ sur l’hôte.\u003c/p\u003e\n\u003cp\u003eLa seule chose à confirmer : l’id de ton utilisateur hôte. C’est souvent 1000 et c’est vérifiable en exécutant \u003ccode\u003eid -u\u003c/code\u003e.\u003c/p\u003e\n\u003ch5 id=\"_etcsubuid\" class=\"discrete\"\u003e/etc/subuid\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65536\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5 id=\"_explication\" class=\"discrete\"\u003eExplication\u003c/h5\u003e\n\u003cp\u003eUn mapping nommé \u003ccode\u003edockremap\u003c/code\u003e est créé :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003e\u003cem\u003e1e ligne :\u003c/em\u003e assigne 1 utilisateur (de conteneur pour nous) vers l’uid 1000. Ce 1e utilisateur est l’utilisateur 0, donc \u003ccode\u003eroot\u003c/code\u003e.\u003c/li\u003e\u003cli\u003e\u003cem\u003e2e ligne :\u003c/em\u003e assigne les 65536 prochains utilisateurs vers la plage commençant par 100001, donc vers 100001-165536. Par exemple, l’utilisateur conteneur 66 sera manipulé sur l’hôte comme étant l’utilisateur 100066.\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eJe pense qu’appliquer le même principe pour les groupes est tout aussi profitable : la transparence est totale. On peut vérifier son \u003ccode\u003egid\u003c/code\u003e avec \u003ccode\u003eid -g\u003c/code\u003e.\u003c/p\u003e\n\u003ch5 id=\"_etcsubgid\" class=\"discrete\"\u003e/etc/subgid\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65536\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5 id=\"_etcdockerdaemon_json\" class=\"discrete\"\u003e/etc/docker/daemon.json\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-json hljs\" data-lang=\"json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"userns-remap\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"dockremap\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eN’oublie pas de redémarrer le daemon docker pour que cela prenne effet 😉\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-bash hljs\" data-lang=\"bash\"\u003esudo service docker restart\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-2\"\u003e\u003ch3 id=\"_mappings_de_ciproduction\"\u003eMappings de CI/production\u003c/h3\u003e\u003cp\u003eEn production, la configuration dépend davantage des permissions que tu veux donner à tes conteneurs. On est davantage sur des problématiques de sécurité que de praticité.\u003c/p\u003e\n\u003cp\u003eIl est possible d’appliquer le même type de configuration que précédemment à condition de bien connaître les conséquences du mapping, en particulier pour l’utilisateur 0.\u003c/p\u003e\u003c/section\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_problèmes_et_trucs_à_savoir\"\u003eProblèmes et trucs à savoir\u003c/h2\u003e\u003cp\u003eIl est possible de mapper plusieurs utilisateurs spécifiques conteneur vers des utilisateurs spécifiques hôte. Par exemple :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65\ndockremap:666:1\ndockremap:100067:65469\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCe qui peut se lire : map 0 conteneur vers 1000 hôte, map les 65 utilisateurs suivants sur la plage hôte commençant par 100001, map le suivant (66) vers 666 sur l’hôte, map le reste sur la plage hôte commençant par 100067.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eJ’espère que cet article t’aura éclairé sur l’utilisation des \u003cem\u003euser namespaces\u003c/em\u003e pour gérer ses permissions Docker. Il s’agit d’un retour d’expérience personnelle et de mes avis sur le sujet. N’hésite pas à explorer par toi-même, faire ta propre configuration et \u003ca href=\"/fr/about/\"\u003eme la partager\u003c/a\u003e 🙂\u003c/p\u003e\u003c/section\u003e","categories":["devops"]}]},"__N_SSG":true},"page":"/fr","query":{},"buildId":"XfiD0591POrqhAMreRIZE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>