{"componentChunkName":"component---src-templates-mdx-template-tsx","path":"/fr/blog/pourquoi-docker","result":{"data":{"mdx":{"id":"cc5ef855-18e2-5b52-b575-55ea40211c30","fields":{"dateEn":"August 06, 2020","dateFr":"6 août 2020"},"frontmatter":{"title":"Pourquoi Docker ?"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Pourquoi Docker ?\",\n  \"categories\": \"devops\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(React.Fragment, null, props.toc), mdx(\"h2\", {\n    \"id\": \"pour-travailler-ensemble\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Pour travailler ensemble\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pour-travailler-ensemble\",\n    \"aria-label\": \"pour travailler ensemble permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Tout le monde d\\xE9veloppe sur diff\\xE9rentes machines. Il n'est pas rare que plusieurs coll\\xE8gues aient install\\xE9 diff\\xE9rentes version d'une m\\xEAme library, d'un package manager, du runtime de leur application... (cc node/npm \\uD83D\\uDC4B)\"), mdx(\"p\", null, \"Lorsque l'application de d\\xE9veloppement est dockeris\\xE9e, tous les devs (et la prod !) sont soumis aux m\\xEAmes r\\xE8gles, ce qui \\xE9vite le syndr\\xF4me de \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"\\\"mais \\xE7a marche sur mon PC\\\"\"), \" tout en r\\xE9duisant la configuration n\\xE9cessaire \\xE0 installer l'environnement de dev. Voir juste apr\\xE8s !\"), mdx(\"h2\", {\n    \"id\": \"pour-moins-perdre-de-temps-à-configurer\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Pour moins perdre de temps \\xE0 configurer\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pour-moins-perdre-de-temps-%C3%A0-configurer\",\n    \"aria-label\": \"pour moins perdre de temps à configurer permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"La configuration, c'est du temps pass\\xE9 \\xE0 ne pas \\xEAtre productif. Plus il y a d'environnements dans lesquels une application doit tourner, plus il y a de configuration \\xE0 faire. Docker permet d'abstraire l'environnement dans lequel tourne l'application et donc de ne faire que le minimum n\\xE9cessaire.\"), mdx(\"p\", null, \"Une cons\\xE9quence notable : pour ajouter un service \\xE0 la stack, plus forc\\xE9ment besoin d'apprendre en d\\xE9tails une technologie. Il suffit d'ajouter une image existante de celle-ci, et de simplement sp\\xE9cifier les variables d'environnement n\\xE9cessaires. Par exemple, pour \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://hub.docker.com/_/postgres/\"\n  }), \"ajouter une database PostgreSQL\"), \", il suffit au minimum de renseigner un root password et de monter un volume pour persister les donn\\xE9es.\"), mdx(\"h2\", {\n    \"id\": \"pour-séparer-les-problèmes\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Pour s\\xE9parer les probl\\xE8mes\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pour-s%C3%A9parer-les-probl%C3%A8mes\",\n    \"aria-label\": \"pour séparer les problèmes permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Comme chaque service est aussi simple que possible, chacun n'a que tr\\xE8s peu de d\\xE9pendances avec le reste du monde. On voit que, par nature, les conteneurs nous poussent \\xE0 n'avoir que le minimum vital de d\\xE9pendances entre services.\"), mdx(\"p\", null, \"Par d\\xE9pendances, je pense en particulier \\xE0 :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Syst\\xE8me, programmes, libraries install\\xE9es\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Configurations associ\\xE9es \\xE0 ce setup\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Volumes (fichiers)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Acc\\xE8s r\\xE9seau\")), mdx(\"h2\", {\n    \"id\": \"pour-gérer-et-sécuriser-les-connexions-réseau\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Pour g\\xE9rer et s\\xE9curiser les connexions r\\xE9seau\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pour-g%C3%A9rer-et-s%C3%A9curiser-les-connexions-r%C3%A9seau\",\n    \"aria-label\": \"pour gérer et sécuriser les connexions réseau permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Car oui : c'est vite fait de faire fuiter le port d'une database, et \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.bleepingcomputer.com/news/security/new-meow-attack-has-deleted-almost-4-000-unsecured-databases/\"\n  }), \"quand elle n'est pas s\\xE9curis\\xE9e c'est g\\xEAnant\"), \" \\uD83D\\uDE2C\"), mdx(\"p\", null, \"L'id\\xE9e est de penser un service comme une bo\\xEEte noire qui expose un ou plusieurs ports. Les services communiquent entre eux gr\\xE2ce aux volumes mont\\xE9s en commun ou \\xE0 travers des ports internes. En effet, les \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.docker.com/compose/networking/\"\n  }), \"services appartenant \\xE0 un m\\xEAme r\\xE9seau\"), \" peuvent par d\\xE9faut s'acc\\xE9der entre eux.\"), mdx(\"h2\", {\n    \"id\": \"pièges-et-trucs-à-savoir\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Pi\\xE8ges et trucs \\xE0 savoir\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pi%C3%A8ges-et-trucs-%C3%A0-savoir\",\n    \"aria-label\": \"pièges et trucs à savoir permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Sous Windows et Mac, les conteneurs tournent sur une VM. Du coup c'est lent, pas natif et les lectures/\\xE9critures disque peuvent ralentir l'\\xE9dition de fichiers. La solution est simple : utilise Linux \\uD83D\\uDE0F (ou un Windows/Mac puissant)\"), mdx(\"p\", null, \"Lorsqu'un m\\xEAme volume (dossier) est mont\\xE9 en \\xE9criture dans deux conteneurs \\xE0 la fois, on peut se retrouver avec des comportements inattendus : chez moi, l'int\\xE9gralit\\xE9 du dossier g\\xE9n\\xE9r\\xE9 par un run de build disparaissait en m\\xEAme temps que le conteneur \\xE0 la fin du run. Je recommande donc vivement de ne monter en \\xE9criture qu'un seul fichier ou dossier \\xE0 la fois.\"), mdx(\"p\", null, \"C'est possible de ne partager en \\xE9criture qu'une partie d'une m\\xEAme arborescence commune. Par exemple, si \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backend\"), \" et \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend\"), \" partagent \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code\"), \" en lecture mais que \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backend\"), \" doit \\xE9crire dans \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code/target\"), \" et \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend\"), \" doit \\xE9crire dans \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code/dist\"), \", alors les volumes peuvent \\xEAtre surcharg\\xE9s comme ceci :\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yml\"\n  }), \"backend:\\n  volumes:\\n    - ./code:/code:ro\\n    - ./code/target:/code/target\\n\\nwebapp:\\n  volumes:\\n    - ./code:/code:ro\\n    - ./code/dist:/code/dist\\n\")), mdx(\"p\", null, \"Les images Docker peuvent vite prendre de l'espace disque. Mais avec le temps, la communaut\\xE9 opte de plus en plus pour des versions minimalistes de chaque image. Autrefois avec une version \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"slim\"), \" de Debian, et aujourd'hui souvent avec une version \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://alpinelinux.org/about/\"\n  }), \"Alpine Linux\"), \" qui permet aux images de faire moins de 10Mo de base ! Pr\\xE9f\\xE8re-donc utiliser les tags \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-alpine\"), \" de chaque image.\"), mdx(\"p\", null, \"Enfin, la gestion des permissions est d\\xE9routante au d\\xE9but. Docker tourne en root par d\\xE9faut et a de bonnes raisons de le faire : autant dire que j'appr\\xE9cie de pouvoir ouvrir les ports 80 ou 443 en dev comme en prod \\uD83D\\uDE42\"), mdx(\"p\", null, \"Pour mieux comprendre pourquoi et comment bien g\\xE9rer ses permissions : \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/fr/blog/gerer-ses-permissions-avec-docker\"\n  }), \"voir cet article\"), \".\"), mdx(\"h2\", {\n    \"id\": \"par-où-commencer\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Par o\\xF9 commencer?\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#par-o%C3%B9-commencer\",\n    \"aria-label\": \"par où commencer permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"En prenant le temps de lire la doc dans l'ordre, tout ne peut que bien se passer :\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.docker.com/get-started/overview/\"\n  }), \"Comprends Docker\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.docker.com/compose/\"\n  }), \"Comprends docker-compose\"), \" pour simplement faire cohabiter les services entre eux\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Installe \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.docker.com/engine/install/\"\n  }), \"docker\"), \" et \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.docker.com/compose/install/\"\n  }), \"docker-compose\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user\"\n  }), \"Ajoute ton user au groupe \", mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"docker\")), \" pour piloter le daemon sans \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"sudo\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"C'est parti ! N'oublie pas de garder la configuration la plus simple possible.\")), mdx(\"details\", {\n    open: false\n  }, mdx(\"summary\", null, \"Exemple\"), mdx(\"p\", null, \"Une stack compl\\xE8te React/Rust/PostgreSQL pourrait \\xEAtre lanc\\xE9e avec la simple config suivante \\xE0 la racine d'un projet :\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yml\"\n  }), \"version: \\\"3\\\"\\nservices:\\n  db:\\n    image: postgres:alpine\\n    environment:\\n      - POSTGRES_PASSWORD=yolo\\n    volumes:\\n      - ./db/data:/var/lib/postgresql/data\\n  backend:\\n    image: rust:slim\\n    environment:\\n      - PGHOST=db\\n      - PGDATABASE=monservice\\n      - PGUSER=root\\n      - PGPASSWORD=yolo\\n    volumes:\\n      - ./backend/:/home/backend\\n      - ./webapp/:/home/webapp:ro\\n    command: cargo run\\n    ports:\\n      - 4000:4000\\n  webapp:\\n    image: node:alpine\\n    environment:\\n      - YARN_VERSION=1.22\\n      - BACKEND_URL=http://backend:4000/\\n    volumes:\\n      - ./webapp/:/home/webapp\\n    command: sh -c \\\"yarn install && CI=true yarn start\\\"\\n    ports:\\n      - 80:8080\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"docker-compose up -d\"), \" et c'est parti directement sur \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://localhost\"\n  }), \"localhost\"), \" ! \\uD83D\\uDCBB\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Pour travailler ensemble Tout le monde développe sur différentes machines. Il n'est pas rare que plusieurs collègues aient installé…","tableOfContents":{"items":[{"url":"#pour-travailler-ensemble","title":"Pour travailler ensemble"},{"url":"#pour-moins-perdre-de-temps-à-configurer","title":"Pour moins perdre de temps à configurer"},{"url":"#pour-séparer-les-problèmes","title":"Pour séparer les problèmes"},{"url":"#pour-gérer-et-sécuriser-les-connexions-réseau","title":"Pour gérer et sécuriser les connexions réseau"},{"url":"#pièges-et-trucs-à-savoir","title":"Pièges et trucs à savoir"},{"url":"#par-où-commencer","title":"Par où commencer?"}]},"timeToRead":3}},"pageContext":{"slug":"pourquoi-docker"}}}