{"componentChunkName":"component---src-templates-mdx-template-tsx","path":"/fr/blog/gerer-ses-permissions-avec-docker","result":{"data":{"mdx":{"id":"e9b415ec-d509-52f8-80e4-33a54b5f65ca","fields":{"dateEn":"September 01, 2020","dateFr":"1 septembre 2020"},"frontmatter":{"title":"Gérer ses permissions avec Docker"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Gérer ses permissions avec Docker\",\n  \"categories\": \"devops\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(React.Fragment, null, props.toc), mdx(\"h2\", {\n    \"id\": \"vocabulaire\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Vocabulaire\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#vocabulaire\",\n    \"aria-label\": \"vocabulaire permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Tout d'abord soyons d'accord sur les mots :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"L'\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"h\\xF4te\")), \" est le syst\\xE8me d'exploitation de la machine, celui qui fait tourner Docker lui-m\\xEAme\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Nous utiliserons \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"conteneur\")), \" pour se r\\xE9f\\xE9rer \\xE0 ce qui est ex\\xE9cut\\xE9 dans l'univers de Docker\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Les \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"user namespaces\")), \", que j'appellerai \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"subuids\")), \", sont une fonctionnalit\\xE9 native Unix pour faire correspondre les ids d'utilisateurs syst\\xE8me vers une page d'utilisateurs donn\\xE9e.\")), mdx(\"p\", null, \"L'article d\\xE9crit comment utiliser les user namespaces (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"subuids\"), \") dans un environnement Unix pour r\\xE9server une plage d'utilisateurs au daemon Docker. Il est probable que Docker for Mac supporte cette fonctionnalit\\xE9.\"), mdx(\"h2\", {\n    \"id\": \"motivation\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Motivation\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#motivation\",\n    \"aria-label\": \"motivation permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Sur l'h\\xF4te, sans configuration donn\\xE9e, les fichiers manipul\\xE9s par Docker appartiennent au m\\xEAme utilisateur que celui du conteneur. Ce n'est pas rassurant dans le sens o\\xF9 le daemon Docker tourne en \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \" par d\\xE9faut et que les conteneurs ne sont pas tenus de s'ex\\xE9cuter en tant que l'utilisateur qui leur a \\xE9t\\xE9 donn\\xE9 en configuration.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Exemple : les images \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"postgres\"), \" et \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"mysql\"), \" \\xE9crivent d'elles-m\\xEAmes une partie de leurs fichiers avec les les utilisateurs de PostgreSQL et MySQL.\")), mdx(\"p\", null, \"Pour \\xE9viter ce probl\\xE8me, nous allons indiquer au daemon Docker \\xE0 quels utilisateurs h\\xF4te correspondent tous les utilisateurs des conteneurs.\"), mdx(\"h2\", {\n    \"id\": \"mise-en-place\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Mise en place\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#mise-en-place\",\n    \"aria-label\": \"mise en place permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"h5\", {\n    noToc: true\n  }, \"Configuration h\\xF4te impact\\xE9e :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/etc/subuid\"), \" - configuration des mappings utilisateur h\\xF4te \", \"<\", \"-\", \">\", \" conteneur\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/etc/subgid\"), \" - configuration des mappings groupe h\\xF4te \", \"<\", \"-\", \">\", \" conteneur\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/etc/docker/daemon.json\"), \" - configuration du daemon Docker\")), mdx(\"p\", null, \"Selon moi, c'est avantageux de configurer diff\\xE9remment ces mappings sur les machines des d\\xE9veloppeurs et en CI/production. En effet : autant tirer profit de cette flexibilit\\xE9 pour d\\xE9velopper confortablement tout en gardant la production sous contr\\xF4le.\"), mdx(\"h3\", {\n    \"id\": \"mappings-de-dev\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Mappings de dev\", mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#mappings-de-dev\",\n    \"aria-label\": \"mappings de dev permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"En mappant le \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \" des conteneurs vers ton utilisateur h\\xF4te, tu peux simplement profiter d'une transparence de permissions par d\\xE9faut. Plus de probl\\xE8mes avec les volumes g\\xE9n\\xE9r\\xE9s en \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \" h\\xF4te puis crashant l'ex\\xE9cution \\xE0 cause de la mauvaise permission !\"), mdx(\"p\", null, \"Pour ma part, je map simplement \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \" vers mon user h\\xF4te puis tous les autres uids 1+ vers 100001+ sur l'h\\xF4te.\"), mdx(\"p\", null, \"La seule chose \\xE0 confirmer : l'id de ton utilisateur h\\xF4te. C'est souvent 1000 et c'est v\\xE9rifiable en ex\\xE9cutant \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id -u\"), \".\"), mdx(\"h5\", {\n    noToc: true\n  }, \"/etc/subuid\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"dockremap:1000:1\\ndockremap:100001:65536\\n\")), mdx(\"h5\", {\n    noToc: true\n  }, \"Explication\"), mdx(\"p\", null, \"Un mapping nomm\\xE9 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dockremap\"), \" est cr\\xE9\\xE9 :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"1e ligne :\"), \" assigne 1 utilisateur (de conteneur pour nous) vers l'uid 1000. Ce 1e utilisateur est l'utilisateur 0, donc \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"root\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"2e ligne :\"), \" assigne les 65536 prochains utilisateurs vers la plage commen\\xE7ant par 100001, donc vers 100001-165536. Par exemple, l'utilisateur conteneur 66 sera manipul\\xE9 sur l'h\\xF4te comme \\xE9tant l'utilisateur 100066.\")), mdx(\"p\", null, \"Je pense qu'appliquer le m\\xEAme principe pour les groupes est tout aussi profitable : la transparence est totale. On peut v\\xE9rifier son \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gid\"), \" avec \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id -g\"), \".\"), mdx(\"h5\", {\n    noToc: true\n  }, \"/etc/subgid\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"dockremap:1000:1\\ndockremap:100001:65536\\n\")), mdx(\"h5\", {\n    noToc: true\n  }, \"/etc/docker/daemon.json\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"{\\n  \\\"userns-remap\\\": \\\"dockremap\\\"\\n}\\n\")), mdx(\"p\", null, \"N'oublie pas de red\\xE9marrer le daemon docker pour que cela prenne effet \\uD83D\\uDE09\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo service docker restart\\n\")), mdx(\"h3\", {\n    \"id\": \"mappings-de-ciproduction\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Mappings de CI/production\", mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#mappings-de-ciproduction\",\n    \"aria-label\": \"mappings de ciproduction permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"En production, la configuration d\\xE9pend davantage des permissions que tu veux donner \\xE0 tes conteneurs. On est davantage sur des probl\\xE9matiques de s\\xE9curit\\xE9 que de praticit\\xE9.\"), mdx(\"p\", null, \"Il est possible d'appliquer le m\\xEAme type de configuration que pr\\xE9c\\xE9demment \\xE0 condition de bien conna\\xEEtre les cons\\xE9quences du mapping, en particulier pour l'utilisateur 0.\"), mdx(\"h2\", {\n    \"id\": \"problèmes-et-trucs-à-savoir\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Probl\\xE8mes et trucs \\xE0 savoir\", mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#probl%C3%A8mes-et-trucs-%C3%A0-savoir\",\n    \"aria-label\": \"problèmes et trucs à savoir permalink\",\n    \"className\": \"anchor after\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))))), mdx(\"p\", null, \"Il est possible de mapper plusieurs utilisateurs sp\\xE9cifiques conteneur vers des utilisateurs sp\\xE9cifiques h\\xF4te. Par exemple :\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"dockremap:1000:1\\ndockremap:100001:65\\ndockremap:666:1\\ndockremap:100067:65469\\n\")), mdx(\"p\", null, \"Ce qui peut se lire : map 0 conteneur vers 1000 h\\xF4te, map les 65 utilisateurs suivants sur la plage h\\xF4te commen\\xE7ant par 100001, map le suivant (66) vers 666 sur l'h\\xF4te, map le reste sur la plage h\\xF4te commen\\xE7ant par 100067.\"), mdx(\"hr\", null), mdx(\"p\", null, \"J'esp\\xE8re que cet article t'aura \\xE9clair\\xE9 sur l'utilisation des \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"user namespaces\"), \" pour g\\xE9rer ses permissions Docker. Il s'agit d'un retour d'exp\\xE9rience personnelle et de mes avis sur le sujet. N'h\\xE9site pas \\xE0 explorer par toi-m\\xEAme, faire ta propre configuration et \", mdx(\"a\", {\n    href: \"/fr/about/\"\n  }, \"me la partager\"), \" \\uD83D\\uDE42\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Vocabulaire Tout d'abord soyons d'accord sur les mots : L' hôte  est le système d'exploitation de la machine, celui qui fait tourner Docker…","tableOfContents":{"items":[{"url":"#vocabulaire","title":"Vocabulaire"},{"url":"#motivation","title":"Motivation"},{"url":"#mise-en-place","title":"Mise en place","items":[{"url":"#mappings-de-dev","title":"Mappings de dev"},{"url":"#mappings-de-ciproduction","title":"Mappings de CI/production"}]},{"url":"#problèmes-et-trucs-à-savoir","title":"Problèmes et trucs à savoir"}]},"timeToRead":2}},"pageContext":{"slug":"gerer-ses-permissions-avec-docker"}}}